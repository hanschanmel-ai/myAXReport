<!doctype html>
<html>
<head>
  <meta charset="utf-8"><title>Items</title>
  <link href="/erp/ns-main.css" rel="stylesheet">
  <style>body{font-family:system-ui,Segoe UI,Arial;margin:24px}table{border-collapse:collapse;width:100%}th,td{border:1px solid #e5e7eb;padding:8px;text-align:left}th{background:#f3f4f6}input,button{padding:8px;border:1px solid #e5e7eb;border-radius:6px}button{background:#1558b0;color:#fff;border:none}</style>
</head>
<body>
  
  <h2>Items</h2>
  <div class="row">
    <input id="sku" placeholder="SKU" value="ITEM1">
    <input id="name" placeholder="Name" value="Item 1">
    <input id="uom" placeholder="UOM" value="EA">
    <button id="create">Create</button>
    <button id="refresh">Refresh</button>
  </div>
  <table>
    <thead><tr><th>SKU</th><th>Name</th><th>UOM</th></tr></thead>
    <tbody id="rows"></tbody>
  </table>
  <script>
    const APIS=['http://127.0.0.1:8788',''];
    async function api(path,opts){for(const base of APIS){try{const r=await fetch((base||'')+path,opts);if(!r.ok)throw new Error('HTTP '+r.status);return await r.json()}catch(e){if(base===APIS[APIS.length-1])throw e}}return []}
    function headers(){const t=localStorage.getItem('token');const h={'Content-Type':'application/json'};if(t)h['Authorization']='Bearer '+t;return h}
    function render(rows){const tb=document.getElementById('rows');tb.innerHTML='';rows.forEach(i=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${i.sku}</td><td>${i.name||i.display||''}</td><td>${i.uom||''}</td>`;tb.appendChild(tr)})}
    async function load(){let rows=[];try{rows=await api('/items')}catch(e){rows=await api('/api/items')}render(rows)}
    async function create(){const sku=document.getElementById('sku').value;const name=document.getElementById('name').value;const uom=document.getElementById('uom').value;let out=null;try{out=await api('/api/items',{method:'POST',headers:headers(),body:JSON.stringify({sku,name,uom})})}catch(e){out=await api('/api/items',{method:'POST',headers:headers(),body:JSON.stringify({sku,name,uom})})}if(out.error)alert(out.error);else{alert('Created '+sku);load()}}
    document.getElementById('refresh').onclick=load
    document.getElementById('create').onclick=create
    load()
  </script>
</body>
</html>
